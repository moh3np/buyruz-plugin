# یادداشت‌های تغییرات Buyruz Settings
هشدار: پیش از هر تغییر، حتماً فایل CONTRIBUTING.md را با دقت کامل بخوانید و بی‌قید و شرط اجرا کنید و پس از اتمام کار تطابق را دوباره چک کنید.

تمام نسخه‌ها باید در این فایل ثبت شوند. هنگام انتشار نسخهٔ جدید:
- عنوان نسخه را با فرمت `## [x.y.z] - YYYY-MM-DD` اضافه کنید.
- تغییرات را به زبان فارسی و کاملاً کاربرمحور توضیح دهید.
- در صورت نیاز به اقدام اضافه (مثل پاک‌سازی کش یا تنظیمات)، آن را در بند جداگانه ذکر کنید.

## [2.3.17] - 2025-12-29
- بازنویسی کامل سیستم الحاق FAQ Rank Math به توضیحات محصول با رویکرد چندلایه:
  - استفاده از هوک `woocommerce_product_tabs` برای تغییر callback تب توضیحات و تضمین نمایش FAQ
  - افزودن fallback با هوک `woocommerce_product_after_tabs` برای قالب‌های غیراستاندارد
  - روش دوگانه برای استخراج FAQ: ابتدا shortcode رنک‌مث و در صورت عدم موفقیت، رندر مستقیم از Schema DB
  - استخراج بهبودیافته schema ID از فیلد `@id` و `metadata.shortcode` 
  - جلوگیری از تکرار FAQ با سیستم کش و پرچم `$appended_ids`
  - پشتیبانی از قالب‌هایی که از لوپ اصلی وردپرس استفاده نمی‌کنند

## [2.3.12] - 2025-12-29
- رفع مشکل ذخیره‌نشدن سوئیچ‌ها در تمام کارت‌های تنظیمات (از جمله پردازش شورت‌کد و FAQ Rank Math) هنگام ذخیره Ajax؛ مقدار اکنون فوراً در پایگاه‌داده ثبت می‌شود.
- برای اطمینان، پاسخ Ajax وضعیت گزینه‌های ذخیره‌شده را بازمی‌گرداند تا UI بتواند به‌روز بماند.

## [2.3.13] - 2025-12-29
- رفع پردازش نشدن شورت‌کد در برخی قالب‌ها: تشخیص نوع محصول ووکامرس از نوع «simple/variable…» به «product» نرمال شد تا فیلترها روی تب توضیحات/خلاصه اعمال شوند.

## [2.3.14] - 2025-12-29
- تضمین پردازش شورت‌کد حتی در قالب‌هایی که مستقیماً محتوای تب توضیحات/خلاصه را بدون فیلترهای وردپرس رندر می‌کنند: پردازش روی the_excerpt، woocommerce_short_description و the_content و همچنین پیش‌پرداخت مستقیم متغیرهای post_content/post_excerpt انجام می‌شود.

## [2.3.15] - 2025-12-29
- افزودن مسیر قطعی برای الحاق FAQ Rank Math به انتهای توضیحات محصول: علاوه بر the_content، روی فیلتر توضیحات ووکامرس (`woocommerce_product_get_description`) و رویداد wp محتوا را پیش‌پرداخت می‌کند تا حتی در قالب‌هایی که از لوپ اصلی استفاده نمی‌کنند HTML آماده تزریق شود.

## [2.3.16] - 2025-12-29
- استخراج ID اسکیما FAQ مقاوم‌تر شد: ابتدا متاهای ذخیره‌شده بررسی می‌شود و سپس در صورت دسترسی از API داخلی Rank Math (`Schema\DB::get_schemas`) خوانده می‌شود؛ تشخیص IDهای کوتاه‌تر یا با پیشوند `#s-` نیز افزوده شد.

## [2.3.17] - 2025-12-29
- رفع محدودیت اجرای افزوده‌سازی FAQ در قالب‌هایی که خارج از لوپ/کوئری اصلی محتوای محصول را رندر می‌کنند؛ تشخیص صفحه محصول بر اساس post_type و is_product انجام می‌شود و فیلتر the_content در حالت relaxed اجرا می‌شود تا FAQ همیشه در توضیحات افزوده شود.

## [2.3.18] - 2025-12-29
- استخراج اسکیما FAQ از هر دو منبع Rank Math (DB و متا) و تولید HTML مستقیم در صورت نبود/خالی بودن خروجی شورت‌کد؛ تشخیص ID از @id و metadata و کلیدهای متا مستحکم شد.
- مسیرهای نمایش افزوده شد: خروجی FAQ علاوه بر تب توضیحات و after_tabs، در after_single_product_summary نیز به‌عنوان fallback نمایش داده می‌شود و جلوگیری از تکرار با کش درون‌درخواستی انجام می‌شود.

## [2.3.11] - 2025-12-29
- رفع مشکل پردازش شورت‌کدها در صفحات محصول حتی با قالب‌هایی که تب توضیحات را خارج از فیلترهای ووکامرس رندر می‌کنند (افزودن پردازش روی the_content با کش درون‌درخواستی).
- اجرای شورت‌کدها همچنان فقط در صورت روشن بودن سوئیچ مربوطه و در فرانت‌اند انجام می‌شود.

## [2.3.10] - 2025-12-29
- هر دو قابلیت جدید قابل کنترل از تنظیمات: پردازش شورت‌کدهای توضیحات/خلاصهٔ محصول و افزودن FAQ Rank Math با سوئیچ مستقل.
- پردازش شورت‌کد فقط در فرانت و روی صفحات محصول فعال می‌شود و از درخواست‌های ادمین/REST دور است.

## [2.3.9] - 2025-12-29
- شورت‌کدها در توضیحات اصلی و خلاصهٔ محصولات ووکامرس پردازش می‌شوند تا محتوای پویا در تب توضیحات نیز نمایش داده شود.

## [2.3.8] - 2025-12-29
- امکان جدید: افزودن خروجی FAQ Rank Math به انتهای تب «توضیحات محصول» ووکامرس با یک سوئیچ جداگانه (به‌صورت پیش‌فرض خاموش).
- پردازش فقط روی صفحات محصول و بدون نوشتن در دیتابیس انجام می‌شود؛ با کش درون‌درخواستی برای جلوگیری از تکرار و افت عملکرد.
- تنظیم مربوطه در کارت ماژول Rank Math در پیشخوان افزونه اضافه شد تا مدیر سایت کنترل فوری داشته باشد.

## [2.3.4] - 2025-11-30
- بازطراحی رابط صفحات تنظیمات با هدر دارای متا، ناوبری چسبان، سایدبار راهنما و کارت‌های واکنش‌گرا که در موبایل هم خواناست.
- ذخیره تنظیمات عمومی و دیباگ بدون رفرش از طریق Ajax سبک به همراه پیام زنده و به‌روزرسانی فوری رنگ برند در صفحه.
- کاهش بار دیتابیس با کش تنظیمات در همان درخواست و لود شرطی منابع فقط روی صفحات بایروز برای سرعت بالاتر.

## [2.3.3] - 2025-11-29
- جابه‌جایی منوی «تنظیمات بایروز» یک پله بالاتر (موقعیت ۲) برای دسترسی سریع‌تر مدیران.

## [2.3.2] - 2025-11-29
- چیدمان صفحهٔ ماژول‌ها بازنویسی شد تا دقیقاً شبیه کارت‌های Rank Math باشد: کارت‌های مربعی با آیکون رنگی، توضیح کوتاه و سوئیچ اسلایدی در پایین.
- سوئیچ‌های ماژول اکنون با Ajax و بدون رفرش صفحه وضعیت را تغییر می‌دهند و پیام لحظه‌ای نمایش می‌دهند.
- هدر و ناوبری تب‌دار جمع‌وجورتر شد تا محتوای اصلی در مرکز توجه باشد.

## [2.3.1] - 2025-11-29
- بازطراحی کامل UI صفحهٔ تنظیمات با الهام از چیدمان کارت‌های Rank Math (شبکهٔ ماژول، سوئیچ اسلایدی و کارت‌های روشن).
- حذف عبارت «Buyruz Dashboard» از بالای صفحه و جایگزینی با هدر مینیمال و ناوبری تب‌دار هماهنگ با سبک رنک مث.
- هماهنگی استایل فرم‌ها و کارت‌های تنظیمات برای خوانایی بهتر و تجربهٔ نزدیک به داشبورد Rank Math.

## [2.3.0] - 2025-11-29
- جابه‌جایی منوی «تنظیمات بایروز» به زیر «پیشخوان» تا جای آن با عادت مدیران وردپرس هماهنگ و دسترسی به تنظیمات سریع‌تر شود.

## [2.2.2] - 2025-11-29
- بازطراحی هدر پیشخوان با کارت گرافیکی مینیمال که فقط نام «تنظیمات بایروز» و نسخهٔ افزونه را نمایش می‌دهد تا صفحه خلوت‌تر باشد.
- حذف کارت‌های چک‌لیست و راهنمای اضافی از صفحهٔ تنظیمات برای جلوگیری از شلوغی و زیاده‌گویی.
- به‌روزرسانی استایل‌ها برای هماهنگی با طراحی جدید و تمرکز روی نمایش نسخه در بالای صفحه.

## [2.2.1] - 2025-11-29
- انتقال منوی «تنظیمات بایروز» به بالاترین جایگاه سایدبار ادمین برای دسترسی سریع‌تر مدیران سایت.
- هماهنگ‌سازی نام افزونه در هدر با برند فارسی بدون پسوند انگلیسی.

## [2.2.0] - 2025-11-29
- ری‌برند به Buyruz Settings: تغییر نام فایل اصلی به `buyruz-settings.php`، متن دامنه به `buyruz-settings`، و هماهنگ‌سازی پیشوندها به BRZ.
- افزایش پیش‌نیاز وردپرس به 6.8.3 و تأکید بر سازگاری PHP 8.1+.
- الزام جملهٔ هشدار CONTRIBUTING در همهٔ فایل‌ها و پاکسازی نام‌گذاری‌ها برای هویت جدید.

## [2.1.5] - 2025-11-29
- ری‌برند کامل به پیشوند/ثابت‌های BRZ و پاکسازی نام‌گذاری‌ها بر اساس معماری جدید؛ تمامی کلاس‌ها، گزینه‌ها و دستگیره‌ها هم‌راستا شدند.
- افزودن جملهٔ الزام‌آور مطالعهٔ CONTRIBUTING در همهٔ فایل‌ها مطابق دستورالعمل سختگیرانهٔ انتشار.
- به‌روزرسانی CSS/JS و بارگذار برای نام‌های جدید و حفظ کارایی/امنیت.
- تغییر نام گزینهٔ ذخیره‌سازی تنظیمات به `brz_options` و هم‌راستا شدن دسته‌بندی‌های تنظیمات و هوک‌ها با نام‌گذاری BRZ.

## [2.1.0] - 2025-11-29
- افزودن نگهبان (Guard) برای الزام PHP 8.1+ و جلوگیری از بارگذاری در محیط‌های ناسازگار.
- ادامهٔ بهینه‌سازی ساختار ماژولار با autoload و بوت مرکزی برای توسعهٔ آینده بدون افت عملکرد.
- تأکید بر به‌روزرسانی دستی و حذف کامل منطق‌های غیر استاندارد مرتبط با آخرین بروزرسانی.

## [2.0.0] - 2025-11-29
- بازطراحی ساختار افزونه با بارگذار کلاس (autoload) و لایه‌بندی ماژولار برای توسعه‌های آینده بدون تغییر در عملکرد فعلی.
- حذف کامل منطق‌های غیر استاندارد آخرین بروزرسانی و هرگونه اتصال به گیت‌هاب؛ تنها به‌روزرسانی دستی از این پس پشتیبانی می‌شود.
- سامان‌دهی پوشه‌ها و نام‌گذاری فایل‌ها (core/admin/front/integration/support) برای نگه‌داری و توسعهٔ ساده‌تر در نسخه‌های بعدی.

## [1.3.11] - 2025-10-24
- اضافه‌شدن کارت «دیباگ و لاگ‌ها» در تنظیمات برای فعال‌سازی لاگ‌گیری بخش‌های مختلف (شروع با فرآیند به‌روزرسانی افزونه).
- ثبت لاگ کامل از تمامی درخواست‌ها، پاسخ‌ها، تصمیمات کش و خطاهای سیستم بروزرسانی در فایل‌های روزانه (`logs/brz-update-*.log`).
- امکان ماسک خودکار توکن‌ها و داده‌های حساس، انتخاب مدت نگهداری (۱ تا ۳۰ روز) و مشاهدهٔ مسیر فایل‌ها از داخل پیشخوان.
- پاکسازی خودکار لاگ‌های قدیمی و اضافه‌شدن هوک‌های دیباگ در خط سیر کامل بروزرسانی برای سهولت عیب‌یابی.

## [1.3.10] - 2025-10-24
- همگام‌سازی مستندات با الزام جدید: هر تغییر باید بلافاصله همراه با نسخهٔ تازه به GitHub پوش شود تا اختلاف نسخه/کد رخ ندهد.
- افزایش نسخهٔ افزونه به 1.3.10 برای هماهنگی با تغییرات مستندات و جلوگیری از تکرار خطای نسخه.

## [1.3.9] - 2025-10-24
- بازنویسی سیستم به‌روزرسانی GitHub با پشتیبانی از ریپوی عمومی بدون توکن، تنظیم اختیاری شاخه و تطبیق خودکار با ریلیزها یا فایل نسخهٔ شاخهٔ انتخابی.
- اعمال هدرهای امنیتی/Authorization روی تمام دامنه‌های دانلود گیت‌هاب، همراه با Allowlist خودکار هنگام فعال بودن `WP_HTTP_BLOCK_EXTERNAL`.
- نمایش پیام‌های خطای شفاف با کد وضعیت، تشخیص محدودیت نرخ و پاک‌سازی کش هنگام `force-check` یا اجرای WP-CLI.
- جلوگیری از ساخت پوشهٔ تکراری پس از نصب آپدیت به کمک تغییر نام منبع استخراج‌شده به پوشهٔ فعلی افزونه.

## [1.3.8] - 2025-10-24
- رفع خطای کشنده هنگام «بررسی دوباره» که به خاطر پاسخ نامعتبر در سیستم به‌روزرسانی وردپرس رخ می‌داد؛ اکنون اتصال نامعتبر گیت‌هاب بدون توقف داشبورد مدیریت نادیده گرفته می‌شود.
- افزایش تاب‌آوری سیستم به‌روزرسانی در برابر داده‌های غیرمنتظره و تهی تا فرآیند بررسی نسخه همیشه کامل شود.

## [1.3.7] - 2025-10-23
- اجرای منطق آکاردئون تنها روی درخواست‌های فرانت‌اند؛ بررسی‌های مدیریتی و کران‌ها دیگر درگیر فیلترهای Rank Math نمی‌شوند.
- تقویت سازگاری با اسکیماهای غیرمعمول به‌گونه‌ای که ساختارهای شیء یا داده‌های ناقص بدون هشدار کنار گذاشته شوند.

## [1.3.5] - 2025-10-23
- جلوگیری از اجرای فیلتر آکاردئون FAQ در نواحی ادمین و درخواست‌های غیرصفحه‌ای برای پرهیز از بروز خطا هنگام بررسی به‌روزرسانی‌ها.
- افزایش پایداری هنگام پردازش اسکیماهایی که ساختار غیرمنتظره دارند.

## [1.3.4] - 2025-10-23
- رفع هشدارهای Rank Math هنگام پردازش اسکیماهایی که کلید `@type` ندارند؛ اکنون فیلتر آکاردئون تنها روی اسکیماهای معتبر اعمال می‌شود.

## [1.3.3] - 2025-10-23
- بازطراحی کامل صفحهٔ تنظیمات با رابط کارت‌محور، هماهنگ با زبان فارسی و آماده برای افزودن ماژول‌های آینده.
- افزودن راهنمای توسعه داخل پنل برای تاکید بر UX مدرن، پاکسازی دیتابیس و استفاده از بهترین الگوهای مهندسی.
- استایل اختصاصی برای صفحهٔ ادمین و یادآوری اصول عملکردی در `CONTRIBUTING.md`.

## [1.3.2] - 2025-10-23
- رفع مشکل عدم نمایش فوری به‌روزرسانی: کش نسخهٔ جدید اکنون حین «بررسی مجدد» پاک می‌شود و هر بار اتصال تازه به گیت‌هاب برقرار می‌گردد.
- کاهش زمان کش نتیجهٔ گیت‌هاب به ۱۰ دقیقه و پاک‌سازی خودکار پس از نصب نسخهٔ جدید.

## [1.3.1] - 2025-10-23
- نمایش تعداد روز باقی‌مانده برای اعتبار توکن گیت‌هاب در صفحهٔ تنظیمات (به‌جای تاریخ و ساعت دقیق).

## [1.3.0] - 2025-10-23
- پشتیبانی از اسکیما و شورت‌کد FAQ افزونه Rank Math: تبدیل خودکار محتوا به آکاردئون با استایل بایروز.
- تشخیص خودکار FAQ در نوشته‌ها و محصولات حتی زمانی که فقط از سازندهٔ اسکیما استفاده شده باشد.

## [1.2.2] - 2025-10-23
- بازنویسی توضیح افزونه در فهرست وردپرس برای معرفی پنل تنظیمات بایروز و حذف لینک اضافه.
- افزودن دکمهٔ «تنظیمات» در لیست افزونه‌ها برای دسترسی مستقیم به صفحهٔ مدیریت.
- نمایش خلاصهٔ تغییرات نسخهٔ جدید هنگام انتشار به عنوان اعلان به‌روزرسانی در وردپرس.

## [1.2.1] - 2025-10-23
- نمایش توکن ذخیره‌شدهٔ گیت‌هاب در صفحهٔ تنظیمات برای جلوگیری از خالی بودن فیلد پس از ذخیره و امکان ویرایش سریع‌تر.

## [1.2.0] - 2025-10-23
- تغییر نام افزونه به «تنظیمات بایروز» و افزودن لینک مستقیم به Codruz.ir در فهرست افزونه‌ها.
- جابه‌جایی صفحهٔ تنظیمات به منوی اصلی پیشخوان برای دسترسی سریع‌تر پیش از افزونهٔ دراگونایزر.
- به‌روزرسانی اسناد برای مسیرهای جدید و آماده‌سازی نسخهٔ تازه جهت انتشار.

## [1.1.0] - 2025-10-23
- افزودن سیستم بررسی و پیشنهاد به‌روزرسانی از مخزن خصوصی گیت‌هاب بدون نیاز به افزونهٔ جانبی.
- امکان ثبت، جایگزینی یا حذف توکن دسترسی گیت‌هاب از صفحهٔ تنظیمات افزونه همراه با نمایش تاریخ انقضای توکن (در صورت ارائهٔ GitHub).

## [1.0.1] - 2025-10-23
- به‌روزرسانی اطلاعات افزونه با نام «کُدروز» و لینک خانهٔ افزونه.
- افزایش نسخه به ۱٫۰٫۱ تا وردپرس امکان جایگزینی نسخه را نمایش دهد.

## [1.0.0] - 2025-10-23
- انتشار اولیهٔ افزونه با آکاردئون اختصاصی برای FAQهای Rank Math و بارگذاری شرطی فایل‌ها.
